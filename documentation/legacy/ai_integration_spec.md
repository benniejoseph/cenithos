# AI Integration Specification - Cycle 2

This specification, generated by Agent L2A3, defines the API contract for interactions between the main backend and the Python AI service.

## 1. AI Proxy Endpoint

To keep the client simple, the main backend will expose a single proxy endpoint to the AI service. The backend is responsible for authenticating the user and injecting the `userId` into the request to the AI service.

-   **Endpoint**: `POST /v1/aiproxy/query`
-   **Handler**: This endpoint will be handled by the (to be created) `AIIntegrationService`.

## 2. Request from Mobile Client to Backend

```json
{
  "query": "How much did I spend on food last month?"
}
```

## 3. Request from Backend to AI Service

The backend enriches the request with the user's ID.

-   **URL**: `http://ai-service-url/v1/orchestrator/route_query`
-   **Method**: `POST`
-   **Body**:
    ```json
    {
      "userId": "user_firebase_uid_123",
      "query": "How much did I spend on food last month?"
    }
    ```

## 4. Response from AI Service to Backend

The AI service's `AgentOrchestrator` processes the query and returns a structured response.

-   **Success Response (200 OK)**:
    ```json
    {
      "responding_agent": "Alex - Expense Coach",
      "response_text": "You spent â‚¹8,500 on food last month. This is 15% higher than your average.",
      "suggested_actions": [
        {
          "label": "View Food Transactions",
          "action_type": "NAVIGATE",
          "action_value": "/transactions?category=food"
        },
        {
          "label": "Set a Budget for Food",
          "action_type": "OPEN_BUDGET_WIZARD",
          "action_value": { "category": "food" }
        }
      ],
      "metadata": {
        "confidence_score": 0.98,
        "processing_time_ms": 1200
      }
    }
    ```

## @imports
-   @import "development_plan.md" 